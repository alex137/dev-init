services:
  app:
    container_name: ${COMPOSE_PROJECT_NAME}-app
    build:
      context: ..
      dockerfile: .devcontainer/Dockerfile
    volumes:
      - ..:/workspaces/repo
      - claude_config:/home/user/.claude
      - claude_code_config:/home/user/.config/claude-code
    ports:
      # Maps the unique port from .env to the container's SSH port
      - "${HOST_PORT_SSH}:22"
    environment:
      # SSH public key for secure remote access (set in .env or export before docker-compose up)
      - SSH_AUTHORIZED_KEYS=${SSH_AUTHORIZED_KEYS:-}
      # Claude API key - passed at runtime, never written to disk
      # Set this in your shell before 'make up': export ANTHROPIC_API_KEY=sk-...
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
    tty: true

volumes:
  claude_config:
    driver: local
  claude_code_config:
    driver: local
