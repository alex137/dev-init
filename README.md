# ğŸ› ï¸ Dev-Init: The Polyglot Plumbing Kit

**Dev-Init** is a recursive, self-bootstrapping development environment template. It provides a standardized "Engine Room" for any project, supporting **Kotlin (via Elide), Rust, Elixir, Gleam, and Haskell**, with deep integration for the **Zed** editor.

## ğŸ—ï¸ The Architecture

This system uses a **Proxy Pattern** to keep your project roots clean:

1. **Root Makefile:** A tiny, universal entry point that forwards all commands to the engine.
2. **.devcontainer/Makefile:** The "Engine Room" containing all Docker, polyglot test discovery, and versioning logic.
3. **.devcontainer/gen_tasks.sh:** A translator that automatically builds your Zed Task UI based on your Makefile comments.

---

## ğŸš€ Getting Started

### 1. Installation

Clone this repository into your main projects directory alongside your other code:

```bash
~/code/
  â”œâ”€â”€ dev-init/      <-- This repo (The "Source of Truth")
  â”œâ”€â”€ my-rust-app/   <-- A target repo
  â””â”€â”€ my-elixir-app/ <-- Another target repo

```

### 2. Initializing a New Project

To "inject" the plumbing into a new or existing repository, run this from the root of the **target** repo:

```bash
make -f ../dev-init/Makefile dev-init

```

---

## âŒ¨ï¸ Usage

### In the Terminal

Once initialized, you can run these from the project root:

| Command | Action |
| --- | --- |
| `make up` | Starts the Docker environment, checks version, and shows ports. |
| `make test` | **Auto-detects** language (Rust/Elixir/Kotlin/Gleam) and runs tests. |
| `make status` | Shows running containers and mapped ports. |
| `make clean` | Wipes untracked Git files (handy for build artifacts). |
| `make dev-init` | Synchronizes/Upgrades the project to the latest plumbing version. |
| `make help` | Lists all available commands and their descriptions. |

### In Zed

Press `Cmd+Shift+P` and type **"task: spawn"**. You will see a list of labels directly mirrored from the `#` comments in your `.devcontainer/Makefile`.

---

## ğŸ”§ Maintenance & Extension

### Adding New Commands

To add a new shortcut to your editor and terminal:

1. Open `.devcontainer/Makefile`.
2. Add a target with a `#` comment:
```makefile
deploy: #Ship to Production
    @scripts/deploy.sh

```


3. Run `make setup-zed`. Your Zed Task UI is now instantly updated.

### Upgrading Plumbing

If you improve the `Dockerfile` or `Makefile` inside the `dev-init` repo:

1. Increment `PLUMBING_VERSION` in `dev-init/.devcontainer/Makefile`.
2. In your other projects, run `make check-version`.
3. Run `make dev-init` to pull the latest updates from the sibling `dev-init` folder.

---

## ğŸ“¦ What's Included?

The included Dockerfile is a "Heavyweight" polyglot environment based on **Debian Bookworm**:

* **Languages:** Rust, Elixir, Gleam, Haskell, Python, Node.js.
* **Runtimes:** Elide (for high-performance Kotlin/JS/Python).
* **AI Tools:** Claude Code CLI.
* **Hardware/Systems:** Clang, LLVM, GDB, Verilator, Yosys, GHDL.
* **Editor Support:** OpenSSH Server configured for Zed remote editing (Password: `zed`).

---

## ğŸ” Security: SSH Key Authentication

To remove the need for the `zed` password, mount your public key:

1. In `.devcontainer/docker-compose.yml`, add:
```yaml
volumes:
  - ~/.ssh/id_rsa.pub:/root/.ssh/authorized_keys:ro

```


2. Ensure your `Dockerfile` sets permissions: `RUN chmod 700 /root/.ssh`.

---

## ğŸ› ï¸ Troubleshooting

### Zed Connection Issues

* **"Failed to connect":** Run `make status` to ensure the container is up.
* **"Permission denied":** If files created in the container are owned by root, run `sudo chown -R $USER:$USER .` on your host machine.
* **Proxy Failure:** Ensure the `Makefile` in your project root is the one generated by `dev-init`.

---

### One-Line Setup Tip

If you are starting a brand-new project, you can initialize and start everything in one go:
`make -f ../dev-init/Makefile dev-init && make up`
